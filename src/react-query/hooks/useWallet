import { useMutation, useQuery } from "@tanstack/react-query";
import APIClientToken from "../services/apiClient-token";
import { API_ENDPOINTS } from "@/utils/api/endpoints";
import { useRouter } from "next/router";

const apiClient = new APIClientToken(API_ENDPOINTS.WALLET);

const useWallet = () => {
	const router = useRouter();

	const {
		data: currentAmount,
		isLoading: isAmountLoading,
		error: amountError,
	} = useQuery("currentAmount", apiClient.getCurrentAmount);

	const { mutate } = useMutation({
		mutationFn: apiClient.post,
		onSuccess: (data) => {
			console.log(data.data);
			if (data.result.http_status_code === 200) {
				// successful
				const paymentUrl = data.data;
				router.push(paymentUrl);
			} else {
				// unsuccessful
				console.error(
					"مشکلی در شارژ کیف پول شما به وجود آمده  است ،  مجددا تلاش کنید",
					console.error(data.result.error_message)
				);
			}
		},
		onError: (error) => {
			console.error("Mutation error:", error);
		},
	});

	return {
		currentAmount,
		isAmountLoading,
		amountError,
		makePayment: (amount) => {
			if (amount < 5000 || amount > 200000) {
				console.error(
					"مبلغ وارد شده نباید کمتر از 5000 و یا بیشتر از 200000 تومان باشد"
				);
				return;
			}

			mutate({ amount });
		},
	};
};

export default useWallet;
